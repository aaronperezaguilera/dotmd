---
import Post from '@/components/blog/Post.astro'
import Bmc from '@/icons/Bmc.astro'
import Layout from '@/layouts/Layout.astro'

import { getCollection } from 'astro:content'
const allPosts = await (
  await getCollection('blog')
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
---

<Layout title='Home'>
  <main class='flex w-full px-6'>
    <section
      class='mx-auto flex w-full max-w-[65ch] flex-col gap-6 dark:border-r-neutral-800'
      id='blog-list'
    >
      <header class='flex items-center justify-between pt-6 md:pt-[65px]'>
        <h1 class='text-xl'>Blog</h1>
        <div>
          <button> RSS </button>
          <button> Filter </button>
        </div>
      </header>
      <div class='flex flex-col gap-2'>
        {allPosts.map((post) => <Post post={post} />)}
      </div>
      <footer
        class='sticky bottom-[65px] w-full border-t border-t-neutral-800 bg-[#131313] sm:bottom-0'
      >
        <a
          href='/'
          class='flex h-full w-full justify-center gap-2 py-6'
        >
          <Bmc /> <span>Invítame a un café</span></a
        >
      </footer>
    </section>
  </main>
</Layout>

<style>
  .bloglist {
    scrollbar-width: none;
  }
</style>

<script is:inline>
  window.addEventListener('click', function () {
    const scrollPosition = document.getElementById('blog-list').scrollTop
    sessionStorage.setItem('scrollPosition', scrollPosition)
  })
  document.addEventListener('astro:page-load', function () {
    const savedScrollPosition = sessionStorage.getItem('scrollPosition')
    document.getElementById('blog-list').scrollTop = savedScrollPosition
  })
</script>
